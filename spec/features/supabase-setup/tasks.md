<!-- SAVE_AS: spec/features/supabase-setup/tasks.md -->

# Задачи

**Фича:** Создать структуру файлов и папок для старта работы с Supabase, стартовые edge-файлы и автодеплой в Supabase.

## Основные направления

### Структура Supabase проекта
- [ ] Подготовить базовую структуру `supabase/` с подпапками `functions/`, `config/`, `migrations/` и заглушками, добавить `supabase/config.toml` с рабочими путями и портами; проверить, что `supabase start` запускается локально без ошибок.
- [ ] Создать `.env.example` с описанием переменных (`SUPABASE_ACCESS_TOKEN`, `SUPABASE_PROJECT_REF`, `SUPABASE_DB_PASSWORD` и т.д.) и README с инструкциями по локальной настройке CLI; убедиться, что чувствительные значения отсутствуют в репозитории.

### Стартовые edge-функции
- [ ] Реализовать шаблон `hello-world` на TypeScript (`index.ts`, `deno.json`, `README.md`) с ответом `200 OK` и JSON `{ message: string }`; выполнить `deno fmt --check`, `deno lint` и `deno test` для функции, а также протестировать локально через `supabase functions serve hello-world`.
- [ ] Создать шаблон вебхука (`webhook-handler`) с обработкой `POST` JSON, описать контракт и примеры payload в README; подтвердить корректность ответа и заголовков через локальный `curl`/HTTPie запрос и `deno test`.
- [ ] Вынести общие настройки в `supabase/functions/deno.json` (strict TS, импорт map, разрешённые URL) и убедиться, что обе функции наследуют конфиг и проходят форматирование/линтинг.

### CI/CD деплой
- [ ] Настроить GitHub Actions workflow `.github/workflows/deploy-supabase-functions.yml` с шагами checkout, установка Deno и Supabase CLI, кэш Deno, прогон `deno fmt --check`, `deno lint`, `deno test`, затем `supabase functions deploy --project-ref $SUPABASE_PROJECT_REF`; ограничить запуск веткой `main` и проверить синтаксис через `act` или `--dry-run` CLI.
- [ ] Подготовить файл с вспомогательными командами (например, `package.json` скрипты или `Makefile`) для локального запуска линтеров и деплоя; убедиться, что команды повторяют шаги CI и документированы в README.
- [ ] Настроить использование секретов GitHub (`SUPABASE_ACCESS_TOKEN`, `SUPABASE_PROJECT_REF`) и предусмотреть в workflow проверку их наличия с понятными сообщениями об ошибке.

## Поддерживающие задачи
- [ ] Документация: обновить README/доп. файлы с правилами именования функций, запуском локального окружения и описанием пайплайна.
- [ ] Наблюдаемость: описать в документации подход к логированию edge-функций и доступу к логам Supabase, указать ответственных за мониторинг.
- [ ] Code review и PR: подготовить чеклист для ревью (линты, тесты, деплой), приложить ссылки на CI и инструкции в описании PR.

## Definition of Done
- Все задачи выполнены и протестированы.
- Релевантные unit/e2e/интеграционные тесты проходят успешно (`deno test`, локальные вызовы функций).
- Документация и операционные инструкции обновлены и понятны команде.
- GitHub Actions для деплоя настроен и проходит без ошибок в пробном запуске.
- Критерии из `accept.md` выполнены (если файл появится).
